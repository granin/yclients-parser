# üéØ COMPLETE HANDOFF FOR NEXT AGENT - YClients Parser Deployment

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –í–°–Æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è YClients –ø–∞—Ä—Å–µ—Ä–∞**

---

## üìã **–¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–û–ï–ö–¢–ê**

### **‚úÖ –ß–¢–û –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–û**
- ‚úÖ **YClients –ø–∞—Ä—Å–µ—Ä —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω** —Å 4-—à–∞–≥–æ–≤–æ–π Playwright –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
- ‚úÖ **Demo –¥–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã** - —Å–∏—Å—Ç–µ–º–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏** - YClients URLs ‚Üí Playwright, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Üí lightweight
- ‚úÖ **22 —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç** (15 unit + 7 regression)
- ‚úÖ **–ß–∏—Å—Ç–∞—è –ø—Ä–æ–¥–∞–∫—à–Ω –∫–æ–ø–∏—è** —Å–æ–∑–¥–∞–Ω–∞ –≤ `/Users/m/git/clients/yclents/pavel-repo-production/`
- ‚úÖ **–†—É—Å—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –ø–æ–ª–Ω–∞—è
- ‚úÖ **Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π** –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å 3 commits
- ‚úÖ **TimeWeb –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** –≥–æ—Ç–æ–≤–∞

### **üîÑ –ß–¢–û –ù–£–ñ–ù–û –ó–ê–í–ï–†–®–ò–¢–¨**
- üîÑ **Push –≤ GitHub** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (needs auth)
- üîÑ **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ TimeWeb** –ø–∞–Ω–µ–ª–∏
- üîÑ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–¥–µ–ø–ª–æ—è** TimeWeb
- üîÑ **Final verification** —Å–∏—Å—Ç–µ–º—ã

---

## üéØ **–ì–õ–ê–í–ù–ê–Ø –ó–ê–î–ê–ß–ê –î–õ–Ø NEXT AGENT**

**–¶–ï–õ–¨**: –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ YClients –ø–∞—Ä—Å–µ—Ä–∞ –Ω–∞ TimeWeb Cloud Apps

**–õ–û–ö–ê–¶–ò–Ø –ü–†–û–î–ê–ö–®–ù –ö–û–î–ê**: `/Users/m/git/clients/yclents/pavel-repo-production/`

---

## üîë **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï CREDENTIALS**

### **GitHub Repository**
```bash
REPO_URL=https://github.com/server4parcer/parser
ACCOUNT=server4parcer
```

### **Supabase Database (–†–ê–ë–û–ß–ò–ï CREDENTIALS)**
```bash
SUPABASE_URL=https://axedyenlcdfrjhwfcokj.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF4ZWR5ZW5sY2RmcmpoZmNva2oiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTcxNzczMjU3NSwiZXhwIjoyMDMzMzA4NTc1fQ.xQrNXHJt5N3DgQzN8rOGP3qOz1c-LL-7dV7ZgAQe3d0
```

### **Pavel's YClients URL (–¢–ï–°–¢–û–í–´–ô)**
```bash
PARSE_URLS=https://n1165596.yclients.com/company/1109937/record-type?o=
```

### **TimeWeb Environment Variables**
```bash
API_HOST=0.0.0.0
API_PORT=8000
API_KEY=timeweb_secure_parser_key_2025
SUPABASE_URL=https://axedyenlcdfrjhwfcokj.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF4ZWR5ZW5sY2RmcmpoZmNva2oiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTcxNzczMjU3NSwiZXhwIjoyMDMzMzA4NTc1fQ.xQrNXHJt5N3DgQzN8rOGP3qOz1c-LL-7dV7ZgAQe3d0
PARSE_URLS=https://n1165596.yclients.com/company/1109937/record-type?o=
PARSE_INTERVAL=600
```

---

## üìÇ **CRITICAL FILE LOCATIONS**

### **Production Copy Location**
```
/Users/m/git/clients/yclents/pavel-repo-production/
```

### **Key Files in Production Copy**
```
/Users/m/git/clients/yclents/pavel-repo-production/
‚îú‚îÄ‚îÄ README.md                     # Russian main documentation
‚îú‚îÄ‚îÄ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï.md               # Russian deployment guide
‚îú‚îÄ‚îÄ –¢–ï–•–ü–û–î–î–ï–†–ñ–ö–ê.md                # Russian technical support
‚îú‚îÄ‚îÄ –§–ò–ù–ê–õ–¨–ù–ê–Ø_–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø.md      # Final documentation
‚îú‚îÄ‚îÄ .env.template                  # Environment template
‚îú‚îÄ‚îÄ .env.timeweb                   # TimeWeb specific env vars
‚îú‚îÄ‚îÄ .gitignore                     # Git ignore rules
‚îú‚îÄ‚îÄ Dockerfile                     # TimeWeb optimized
‚îú‚îÄ‚îÄ README_TIMEWEB.md              # TimeWeb deployment instructions
‚îú‚îÄ‚îÄ requirements.txt               # Python dependencies
‚îú‚îÄ‚îÄ lightweight_parser.py          # MAIN ENTRY POINT
‚îú‚îÄ‚îÄ super_simple_startup.py        # Alternative startup
‚îú‚îÄ‚îÄ startup.py                     # Alternative startup
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ parser/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ yclients_parser.py     # MAIN PLAYWRIGHT PARSER WITH 4-STEP NAV
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parser_router.py       # URL ROUTING SYSTEM
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ production_data_extractor.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ data_extractor.py
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db_manager.py          # SUPABASE INTEGRATION
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ queries.py
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes.py              # REST API ENDPOINTS
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.py
‚îÇ   ‚îú‚îÄ‚îÄ browser/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ browser_manager.py     # PLAYWRIGHT BROWSER MANAGEMENT
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ proxy_manager.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stealth_config.py
‚îÇ   ‚îî‚îÄ‚îÄ export/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ settings.py                # APP CONFIGURATION
‚îÇ   ‚îî‚îÄ‚îÄ logging_config.py
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ install.sh
‚îÇ   ‚îú‚îÄ‚îÄ setup_db.py                # DATABASE INITIALIZATION
‚îÇ   ‚îî‚îÄ‚îÄ update_db_schema.py
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ run_tests.py
    ‚îú‚îÄ‚îÄ test_parser_units.py       # 15 UNIT TESTS
    ‚îî‚îÄ‚îÄ test_no_demo_data.py       # 7 REGRESSION TESTS
```

### **Original Development Location (DON'T USE)**
```
/Users/m/git/clients/yclents/pavel-repo/    # Original dev folder - DON'T USE FOR DEPLOY
```

---

## üöÄ **STEP-BY-STEP DEPLOYMENT COMMANDS**

### **Step 1: Navigate to Production Copy**
```bash
cd /Users/m/git/clients/yclents/pavel-repo-production
pwd  # Should show: /Users/m/git/clients/yclents/pavel-repo-production
```

### **Step 2: Verify Git Repository Status**
```bash
git status
git log --oneline -5
git remote -v
# Should show: origin https://github.com/server4parcer/parser.git
```

### **Step 3: Push to GitHub (CRITICAL)**
```bash
# You may need to authenticate with GitHub
git push -u origin main

# If authentication fails, try:
# Option A: SSH (if SSH keys are set up)
git remote set-url origin git@github.com:server4parcer/parser.git
git push -u origin main

# Option B: Personal Access Token
# Use your GitHub username and Personal Access Token as password
```

### **Step 4: Verify GitHub Push Success**
```bash
# Check that files are uploaded
curl -s "https://api.github.com/repos/server4parcer/parser/contents" | jq -r '.[].name' | grep -E "(README\.md|Dockerfile|lightweight_parser\.py)"

# Should return these files indicating successful push
```

### **Step 5: TimeWeb Environment Setup**
**IMPORTANT**: In TimeWeb Cloud Apps panel, add these environment variables:

```bash
API_HOST=0.0.0.0
API_PORT=8000
API_KEY=timeweb_secure_parser_key_2025
SUPABASE_URL=https://axedyenlcdfrjhwfcokj.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF4ZWR5ZW5sY2RmcmpoZmNva2oiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTcxNzczMjU3NSwiZXhwIjoyMDMzMzA4NTc1fQ.xQrNXHJt5N3DgQzN8rOGP3qOz1c-LL-7dV7ZgAQe3d0
PARSE_URLS=https://n1165596.yclients.com/company/1109937/record-type?o=
PARSE_INTERVAL=600
```

### **Step 6: Verify Deployment**
After TimeWeb auto-deployment:

```bash
# Health check (replace with actual TimeWeb app URL)
curl https://your-app.timeweb.cloud/health

# Parser status
curl https://your-app.timeweb.cloud/parser/status

# Trigger manual parsing
curl -X POST https://your-app.timeweb.cloud/parser/run

# Check for data (should NOT contain demo data)
curl https://your-app.timeweb.cloud/api/booking-data
```

---

## üîß **GIT REPOSITORY STATUS**

### **Current Commits in Production Copy**
```
5d54ab2 ‚öôÔ∏è TimeWeb Cloud Apps configuration
cd30846 üßπ –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞: —É–¥–∞–ª–µ–Ω—ã backup —Ñ–∞–π–ª—ã –∏ –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã  
e7acfc6 üöÄ –ü–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑ YClients –ø–∞—Ä—Å–µ—Ä–∞
```

### **Git Configuration**
```bash
# Remote configured:
origin https://github.com/server4parcer/parser.git

# Branch:
main

# Status: Ready to push (all changes committed)
```

---

## üß™ **TESTING VERIFICATION**

### **Tests That Must Pass**
```bash
cd /Users/m/git/clients/yclents/pavel-repo-production

# Unit tests (should pass 15/15)
python3 -m pytest tests/test_parser_units.py -v

# Regression tests (should pass 7/7)  
python3 -m pytest tests/test_no_demo_data.py -v

# Import test
python3 -c "from src.parser.parser_router import ParserRouter; print('‚úÖ Imports work')"
```

### **Expected Test Results**
- ‚úÖ **15 unit tests pass** - Price cleaning, duration parsing, venue extraction
- ‚úÖ **7 regression tests pass** - No demo data methods, empty lists on failure
- ‚úÖ **All imports work** - No missing dependencies

---

## üìä **SYSTEM ARCHITECTURE OVERVIEW**

### **Core Components**
1. **lightweight_parser.py** - Main entry point, API server
2. **src/parser/yclients_parser.py** - Playwright parser with 4-step navigation
3. **src/parser/parser_router.py** - Routes YClients URLs to Playwright
4. **src/database/db_manager.py** - Supabase integration

### **4-Step YClients Navigation Flow**
```python
# Implemented in src/parser/yclients_parser.py
async def navigate_yclients_flow(self, page: Page, url: str) -> List[Dict]:
    # Step 1: Service selection (record-type)
    # Step 2: Court selection (select-master)  
    # Step 3: Date/time selection (select-time)
    # Step 4: Price extraction (select-services) <- PRICES APPEAR HERE!
```

### **URL Routing Logic**
```python
# Implemented in src/parser/parser_router.py
def is_yclients_url(self, url: str) -> bool:
    # YClients URLs ‚Üí Playwright parser (4-step navigation)
    # Other URLs ‚Üí Lightweight parser (or empty)
```

---

## üö® **CRITICAL SUCCESS CRITERIA**

### **Functional Requirements**
- ‚úÖ **Zero demo data** - System NEVER returns fake/demo data
- ‚úÖ **4-step navigation** - Uses discovered YClients flow
- ‚úÖ **Real data extraction** - Court names, prices, times from actual venues
- ‚úÖ **Automatic scheduling** - Parses every 10 minutes
- ‚úÖ **Supabase integration** - Data saves to database

### **Technical Requirements**
- ‚úÖ **22 tests passing** - All unit and regression tests
- ‚úÖ **Playwright browser automation** - Handles JavaScript-heavy YClients
- ‚úÖ **REST API** - Endpoints for status, data, manual parsing
- ‚úÖ **TimeWeb compatibility** - Dockerfile optimized for Cloud Apps

---

## üìù **DOCUMENTATION FILES**

### **Russian Documentation (in production copy)**
- **README.md** - Main Russian documentation
- **–†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï.md** - Complete TimeWeb VDS deployment guide  
- **–¢–ï–•–ü–û–î–î–ï–†–ñ–ö–ê.md** - Troubleshooting and maintenance
- **README_TIMEWEB.md** - TimeWeb Cloud Apps specific instructions

### **Configuration Files**
- **.env.template** - Environment variables template
- **.env.timeweb** - TimeWeb specific environment variables
- **Dockerfile** - TimeWeb optimized Docker configuration

---

## üîç **TROUBLESHOOTING GUIDE**

### **If GitHub Push Fails**
```bash
# Check authentication
git remote -v
git config --global user.name
git config --global user.email

# Try different authentication method
git remote set-url origin git@github.com:server4parcer/parser.git
```

### **If TimeWeb Deployment Fails**
- Check environment variables are set in TimeWeb panel
- Verify GitHub repository is accessible
- Check TimeWeb logs for errors
- Ensure port 8000 is used (not 3000 or other)

### **If Tests Fail**
```bash
# Check imports
python3 -c "from src.parser.parser_router import ParserRouter"

# Check dependencies
pip3 install -r requirements.txt

# Run specific failing test
python3 -m pytest tests/test_parser_units.py::TestPriceExtraction::test_clean_price_removes_commas -v
```

### **If No Data Extracted**
```bash
# Test Supabase connection
python3 -c "
from src.database.db_manager import DatabaseManager
import asyncio
import os

os.environ['SUPABASE_URL'] = 'https://axedyenlcdfrjhwfcokj.supabase.co'
os.environ['SUPABASE_KEY'] = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF4ZWR5ZW5sY2RmcmpoZmNva2oiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTcxNzczMjU3NSwiZXhwIjoyMDMzMzA4NTc1fQ.xQrNXHJt5N3DgQzN8rOGP3qOz1c-LL-7dV7ZgAQe3d0'

async def test():
    db = DatabaseManager()
    await db.initialize()
    print('‚úÖ Supabase connected')

asyncio.run(test())
"
```

---

## ‚ö° **QUICK START COMMANDS FOR NEXT AGENT**

```bash
# 1. Navigate to production copy
cd /Users/m/git/clients/yclents/pavel-repo-production

# 2. Check git status
git status && git log --oneline -3

# 3. Push to GitHub
git push -u origin main

# 4. Verify push success
curl -s "https://api.github.com/repos/server4parcer/parser/contents" | jq -r '.[].name' | head -5

# 5. Test production copy locally
python3 -c "from src.parser.parser_router import ParserRouter; print('‚úÖ Ready')"

# 6. Check TimeWeb auto-deployment status
# (After setting environment variables in TimeWeb panel)
```

---

## üéØ **FINAL SUCCESS INDICATORS**

When deployment is successful, you should see:

### **1. GitHub Repository Updated**
- Files visible at https://github.com/server4parcer/parser
- README.md shows Russian documentation
- Dockerfile present and TimeWeb optimized

### **2. TimeWeb App Running**  
- Health endpoint responds: `curl https://app.timeweb.cloud/health`
- Parser status shows "–≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ": `curl https://app.timeweb.cloud/parser/status`

### **3. Real Data Parsing**
- Manual parsing works: `curl -X POST https://app.timeweb.cloud/parser/run`
- Data endpoint returns real venues: `curl https://app.timeweb.cloud/api/booking-data`
- NO demo data (no "–£–ª—å—Ç—Ä–∞–ø–∞–Ω–æ—Ä–∞–º–∏–∫" unless from real –ù–∞–≥–∞—Ç–∏–Ω—Å–∫–∞—è venue)

### **4. Automated Scheduling**  
- Background parser runs every 10 minutes
- Database gets updated with fresh booking data
- Logs show successful 4-step navigation

---

## üìû **EMERGENCY CONTACTS & REFERENCES**

### **File Locations Reference**
```
PRODUCTION CODE: /Users/m/git/clients/yclents/pavel-repo-production/
ORIGINAL DEV:    /Users/m/git/clients/yclents/pavel-repo/ (DON'T USE)
CREDENTIALS:     /Users/m/git/clients/yclents/pavel-repo/DEPLOYMENT_CREDENTIALS.md
CLAUDE MD:       /Users/m/git/clients/yclents/pavel-repo/CLAUDE.md
```

### **Key URLs**
- **GitHub**: https://github.com/server4parcer/parser
- **Supabase**: https://axedyenlcdfrjhwfcokj.supabase.co  
- **TimeWeb**: (app URL after deployment)

### **Critical Environment Variables**
```bash
SUPABASE_URL=https://axedyenlcdfrjhwfcokj.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF4ZWR5ZW5sY2RmcmpoZmNva2oiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTcxNzczMjU3NSwiZXhwIjoyMDMzMzA4NTc1fQ.xQrNXHJt5N3DgQzN8rOGP3qOz1c-LL-7dV7ZgAQe3d0  
PARSE_URLS=https://n1165596.yclients.com/company/1109937/record-type?o=
```

---

## üèÜ **PROJECT COMPLETION STATUS**

### **‚úÖ COMPLETED (100%)**
- YClients 4-step navigation implementation
- Demo data elimination (zero fallbacks)  
- Parser routing system (YClients ‚Üí Playwright)
- 22 comprehensive tests (all passing)
- Russian documentation (complete)
- Production code cleanup (4845 ‚Üí 128 files)
- Git repository preparation (3 commits ready)
- TimeWeb configuration (Dockerfile + env vars)

### **üîÑ REMAINING (Final 5%)**
- GitHub push (authentication required)
- TimeWeb environment variable setup
- Final deployment verification

**üéØ ESTIMATED TIME TO COMPLETE: 15-30 minutes**

---

**üö® CRITICAL: Next agent MUST use production copy at `/Users/m/git/clients/yclents/pavel-repo-production/` NOT the original dev folder!**

**üéâ The YClients parser is 95% complete and ready for final deployment!**